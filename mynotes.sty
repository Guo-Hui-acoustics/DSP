% mynotes.sty - 我的个人笔记样式文件 

% 0. 文件标识
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{mynotes}[2025/10/06 My Personal Notes Style]

% 1. 引入依赖的宏包 
% 1.1. 字体
\usepackage{newtxtext} 
\usepackage{inconsolata}
\usepackage[T1]{fontenc}
% 1.2. 布局
\usepackage[a4paper, top=2.54cm, bottom=2.54cm, left=1.91cm, right=1.91cm]{geometry}
\usepackage{lipsum}   
\usepackage{abstract} 
\usepackage{graphicx} 
\usepackage{float}    
\usepackage{subcaption} 
\RequirePackage{setspace}
\setstretch{1.5}
% 1.3. 数学
\usepackage{amsmath}   
\usepackage{amssymb}
\usepackage{arydshln} 
\usepackage{empheq}
% 1.4. 绘图与颜色
\usepackage{tikz} 
\usetikzlibrary{tikzmark}     
\usetikzlibrary{fit}          
\usetikzlibrary{positioning}  
\usepackage{color}
\usetikzlibrary{arrows.meta}
\usetikzlibrary{positioning} 
\usetikzlibrary{shapes.geometric, calc, tikzmark} 
\usepackage{pgfplots}
\pgfplotsset{compat=1.18} 
\usepgfplotslibrary{groupplots}
\usepackage{xcolor}  
% 1.5. 交叉引用
\definecolor{lightblue}{rgb}{0.2, 0.4, 0.8} 
\usepackage{hyperref} 
\hypersetup{
    colorlinks=true, linkcolor=blue, citecolor=green, 
    urlcolor=cyan, linkbordercolor={1 1 1},
}
\renewcommand{\eqref}[1]{\hyperref[#1]{\textup{\tagform@{\ref*{#1}}}}}
\usepackage{nameref} 
% 1.6. 页眉和页脚
\usepackage{fancyhdr} 
\usepackage{lastpage}
\usepackage{calc} % 用于进行尺寸的四则运算


% 2. 定义页眉和页脚样式
\newlength{\hHeight}
\newlength{\mHeight}
% 测量当前字体下大写 H 和小写 m 的高度
\settoheight{\hHeight}{H}
\settoheight{\mHeight}{m}
\setlength{\headsep}{1.5\hHeight}
\setlength{\footskip}{\dimexpr 1.0\mHeight + \baselineskip \relax}
\setlength{\headheight}{15pt}
\pagestyle{fancy} % 将默认页面样式设为 fancy
\fancyhf{} % 清空所有当前的页眉页脚设置
% 2.1. 页眉设置，PDF 在页眉显示章节标题 
%\fancyhead[L]{\leftmark} % \leftmark 会自动获取 \section{...} 的内容
\fancyhead[R]{\textbf{\leftmark}}
\renewcommand{\sectionmark}[1]{
    \markboth{\thesection.\ #1}{}
}
% 2.2. 页脚设置
\fancyfoot[C]{\thepage\ / \pageref{LastPage}} % PDF 在页脚右侧显示 "Page X von Y" 
% 2.3. 分割线
\renewcommand{\headrulewidth}{0.4pt}
% 2.4. 设置页眉间距
\renewcommand{\headruleskip}{0pt}


% 3. 为封面页定义新的存储命令
\newcommand{\notetitle}[1]{\def\@notetitle{#1}}
\newcommand{\noteauthor}[1]{\def\@noteauthor{#1}}
\newcommand{\notedate}[1]{\def\@notedate{#1}}
\newcommand{\noteabstract}[1]{\def\@noteabstract{#1}}
% 3.1. 为新封面布局声明变量
\newsavebox{\ContentAboveRuleBox}
\newdimen{\TotalBoxHeight}
\newdimen{\SpaceBefore}
% 3.2. 生成封面页
%    创建命令来生成 *新的* 封面页
%    这个命令现在包含了 'lrbox' 测量和 'titlepage' 布局
\newcommand{\makenotetitle}{
    % 测量和计算
    % (这必须在 \begin{document} 之后执行，所以我们把它放在这里)
    \begin{lrbox}{\ContentAboveRuleBox}
        \begin{minipage}{\linewidth} % 使用 minipage 确保宽度正确
            % 1. 标题与作者 (使用 \@notetitle 和 \@noteauthor 变量)
            {\Huge \centering  \@notetitle \par}
            {\large \hfill \@noteauthor \par}

            % 2. 顶部横线
            \noindent\rule{\linewidth}{2pt}\par
            
            % 4. 中心"图像" (临时占位符)
            \vspace{0.2cm} % 顶部横线下的间距
            \begin{center}
                % --- PGFPlots 样式定义 (必须放在这里) ---
                \pgfplotsset{
                    compat=1.18, % 确保已加载 pgfplots
                    % 样式 1: 用于输入/输出信号图
                    signalplot/.style={
                        width=5.5cm, height=3.5cm, % 图像尺寸
                        hide axis, samples=101, domain=0:12.566,
                        enlargelimits=false, ymin=-3.2, ymax=3.2,
                    },
                    % 样式 2: 用于滤波器频率响应图
                    filterplot/.style={
                        width=4.5cm, height=3.5cm, % 滤波器图像尺寸 (等高)
                        samples=51, domain=-5:5, ymin=0, ymax=1.2,
                        axis lines=middle, enlargelimits=false,
                        xticklabels={}, yticklabels={},
                        xlabel=$\omega$, ylabel=$|H(j\omega)|$,
                        every axis x label/.style={at=(current axis.right of origin), anchor=west, font=\small},
                        every axis y label/.style={at=(current axis.above origin), anchor=south, font=\small}
                    }
                }
                % --- 使用 savebox 预先绘制所有三个图像 (必须放在这里) ---

                % 盒子 1: 混合信号
                \newsavebox{\mixedsignalplot}
                \savebox{\mixedsignalplot}{%
                    \begin{tikzpicture}
                    \begin{axis}[signalplot]
                        \addplot [blue, thick] {sin(deg(x)) + sin(deg(2*x)) + sin(deg(4*x))};
                        \draw [black, dashed, opacity=0.5] (axis cs:0,0) -- (axis cs:12.566,0);
                    \end{axis}
                    \end{tikzpicture}%
                }

                % 盒子 2: 纯 sinx 信号
                \newsavebox{\sinesignalplot}
                \savebox{\sinesignalplot}{%
                    \begin{tikzpicture}
                    \begin{axis}[signalplot]
                        \addplot [blue, thick] {sin(deg(x))};
                        \draw [black, dashed, opacity=0.5] (axis cs:0,0) -- (axis cs:12.566,0);
                    \end{axis}
                    \end{tikzpicture}%
                }

                % 盒子 3: 低通滤波器 (L-P Filter)
                \newsavebox{\lpfplot}
                \savebox{\lpfplot}{%
                    \begin{tikzpicture}
                    \begin{axis}[filterplot]
                        \addplot [red, thick, smooth] {exp(-0.2*x^2)};
                    \end{axis}
                    \end{tikzpicture}%
                }

                % --- TikZ 图像开始 (绘制最终框图) ---
                \begin{tikzpicture}[
                    % 样式：用于放置绘图的节点 (带边框)
                    plot_node/.style={
                        draw, 
                        rectangle, 
                        inner sep=0pt % 边框紧贴图像
                    },
                    % 样式：设置默认箭头
                    >=Stealth
                  ]
                  
                  % 1. 放置左侧的 'Input' 图像
                  \node (in2) [plot_node] {\usebox{\mixedsignalplot}};
                  
                  % 2. 放置中心的 'Filter' 图像
                  \node (sys2) [plot_node, right=0.5cm of in2] {\usebox{\lpfplot}};
                  
                  % 3. 放置右侧的 'Output' 图像
                  \node (out2) [plot_node, right=0.5cm of sys2] {\usebox{\sinesignalplot}};
                  
                  % 4. 绘制箭头
                  \draw [->] (in2) -- (sys2);
                  \draw [->] (sys2) -- (out2);
                  
                  \node [
                      draw, black,                   % 绘制黑色边框
                      rounded corners=3pt,           % 轻微的圆角
                      % 适配所有三个图像节点
                      fit=(in2) (sys2) (out2), 
                      inner sep=10pt                 % 边框与内容的间距 (可调整)
                  ] {};

                \end{tikzpicture}
            \end{center}
            \vspace{0.2cm} % 底部横线上的间距
        \end{minipage}
    \end{lrbox}
    % 计算总高度
    \TotalBoxHeight=\dimexpr\ht\ContentAboveRuleBox + \dp\ContentAboveRuleBox\relax
    % 计算顶部空白 (使用 geometry 设置的 1in 边距)
    \SpaceBefore=\dimexpr 0.5\paperheight - 1in - \TotalBoxHeight \relax
    % 标题页渲染
    \begin{titlepage}
        \pagestyle{empty} % 标题页不显示页码
        % 插入我们计算好的顶部空白
        \vspace*{\SpaceBefore}
        
        % 渲染 "保存盒" 里的所有内容
        \noindent\usebox{\ContentAboveRuleBox}\par
        
        % 渲染底部的横线 (精确位于页面 1/2 处)
        \noindent\rule{\linewidth}{2pt}\par
        
        % 页脚信息
        \vfill 
        \small % 页脚使用小号字体
        % 版权行 (使用 \@noteauthor 和 \@notedate 变量)
        Copyright \copyright\ \@notedate\ \@noteauthor  \ (\href{gh20222734@163.com}{gh20222734@163.com})
        \par 
        % 许可证行 (占位符)
        This work is licensed under a Creative Commons Attribution 4.0 International License.
        \par 
        % 链接行 (占位符)
        Project repository: \url{https://github.com/Guo-Hui-acoustics/DSP}
        %\par
        %Document source: \url{https://example.com/notes/download}
    \end{titlepage}
}


% 4. 创建一个命令来生成 *单独的* 摘要页
\newcommand{\makeabstractpage}{
    \newpage % 开始新的一页
    \thispagestyle{empty} % 本页不显示页码
    % 1. 手动创建左对齐、加粗的 "Abstract" 标题
    \noindent{\Large\bfseries Abstract\par} 
    % 2. 打印摘要内容。
    \@noteabstract
    \clearpage % 结束本页
}


% 5. 自定义图片插入命令
    % 5.1. 单图插入命令 \insertsingleimage
    \newcommand{\insertsingleimage}[3]{
        \begin{figure}[H]
            \centering
            \includegraphics[width=0.7\textwidth]{#1}
            \caption{#2}
            \label{#3}
        \end{figure}
    }
    % 5.2. 双图插入命令 \insertdoubleimage
    \newcommand{\insertdoubleimage}[8]{
            \begin{figure}[H]
                \centering
                % 第一个子图
                \begin{subfigure}[b]{0.48\textwidth}
                    \centering
                    \includegraphics[width=\textwidth]{#1}
                    \caption{#2}
                    \label{#3}
                \end{subfigure}
                \hfill % 水平间距
                % 第二个子图
                \begin{subfigure}[b]{0.48\textwidth}
                    \centering
                    \includegraphics[width=\textwidth]{#4}
                    \caption{#5}
                    \label{#6}
                \end{subfigure}
                \caption{#7}
                \label{#8}
            \end{figure}
        }


% 6. 自定义一个插入 TikZ 图像的命令
\newcommand{\inserttikzpicture}[3]{
    \begin{figure}[H]
        \centering
        \begin{tikzpicture}[
            scale=1.2,
            font=\small
        ]
            % 参数 #1: 用户输入的 TikZ 绘图代码会在这里展开
            #1
        \end{tikzpicture}
        \caption{#2} % 参数 #2: 图片标题
        \label{#3}   % 参数 #3: 图片标签
    \end{figure}
}


% 7. 自定义表格插入命令
\newcommand{\inserttable}[4]{
    \begin{table}[H] % 使用 [H] 选项让表格出现在代码所在的位置
        \centering   % 表格整体居中
        \caption{#3} % 设置表格标题
        \label{#4}   % 设置表格标签
        \begin{tabular}{#1} % #1 是用户传入的列格式
            \hline \hline % 表格顶部的双横线，更具学术风格
            % #2 是用户传入的表格内容
            #2 \\
            \hline \hline % 表格底部的双横线
        \end{tabular}
    \end{table}
}

    
% 8. 自定义代码块插入命令，依赖 minted 宏包
\usepackage{minted}
\setminted{
    frame=single, framesep=2mm, fontsize=\small, 
    breaklines, tabsize=4, python3=true         
}
\definecolor{bg}{rgb}{0.16, 0.16, 0.18} 
\newcommand{\insertcodefromfile}[4]{
    \begin{figure}[H]
        \centering
        \inputminted{#1}{#2}
        \caption{#3}
        \label{#4}
        \end{figure}
}